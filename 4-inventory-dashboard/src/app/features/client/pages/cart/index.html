<div class="cart-container text-white p-5">

    <!-- HEADER -->
    <div class="flex justify-between items-center mb-5">
        <div class="flex items-center gap-2">
            <i class="pi pi-shopping-cart text-2xl" style="font-size: 2rem"></i>
            <h2 class="text-2xl">My Cart</h2>
        </div>
        <p-button label="Clear Cart" class="p-button-danger p-button-text" [disabled]="CartItems().length === 0"
            (click)="clearCart()">
        </p-button>
    </div>

    <!-- EMPTY CART -->
    <ng-container *ngIf="CartItems().length === 0">
        <div
            class="min-h-[50vh] flex flex-col justify-center items-center rounded-lg border border-zinc-700 bg-charcoal shadow-inner p-10 gap-6">

            <!-- Icon -->
            <div
                class="flex items-center justify-center w-32 h-32 rounded-full bg-zinc-800 shadow-lg text-6xl text-gray-400">
                <i class="pi pi-cart-arrow-down" style="font-size: 3rem;"></i>
            </div>

            <!-- Message -->
            <h3 class="text-xl font-semibold text-gray-100">Your Cart is Empty</h3>
            <p class="text-gray-400 text-center max-w-xs">
                Looks like you havenâ€™t added any equipments yet. Explore our collection and add your favorite items to
                the cart.
            </p>

            <!-- Call-to-action -->
            <a routerLink="/client/equipments"
                class="px-6 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold shadow-lg transition-all duration-200">
                Browse Equipments
            </a>
        </div>
    </ng-container>

    <!-- CART ITEMS GRID -->
    <ng-container *ngIf="CartItems().length > 0">
        <div class="grid gap-4 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3">
            <div *ngFor="let item of CartItems()"
                class="bg-zinc-800 p-4 rounded-lg shadow-lg flex flex-col justify-between">

                <!-- ITEM INFO -->
                <div class="flex justify-between items-start mb-4">
                    <div class="flex flex-col max-w-xs">
                        <span class="font-semibold truncate" [title]="item.Equipment?.name">{{ item.Equipment?.name
                            }}</span>
                        <span class="text-gray-400">{{ item.Equipment?.price | currency: "INR" }}</span>
                    </div>
                    <button pButton type="button" icon="pi pi-trash"
                        class="p-button-rounded p-button-text p-button-danger" pTooltip="Remove Item"
                        (click)="removeItem(item)">
                    </button>
                </div>

                <!-- QUANTITY CONTROLS -->
                <div class="flex items-center gap-2 mb-2">
                    <button pButton type="button" icon="pi pi-minus" class="p-button-rounded p-button-text"
                        [disabled]="item.Quantity <= 1" pTooltip="Decrease Quantity" (click)="updateQuantity(item, -1)">
                    </button>
                    <span class="px-3 font-medium">{{ item.Quantity }}</span>
                    <button pButton type="button" icon="pi pi-plus" class="p-button-rounded p-button-text"
                        [disabled]="item.Quantity >= (item.Equipment?.availableCount || 0)" pTooltip="Increase Quantity"
                        (click)="updateQuantity(item, 1)">
                    </button>
                    <span class="ml-auto font-semibold">{{ (item.Equipment?.price || 0) * item.Quantity | currency:
                        "INR" }}</span>
                </div>
            </div>
        </div>

        <!-- STICKY FOOTER -->
        <div class="sticky bottom-0 bg-zinc-900 p-4 flex justify-between items-center shadow-lg mt-4 rounded-t-lg z-10">
            <span class="text-xl font-bold">Total: {{ total | currency: "INR" }}</span>
            <a (click)="handleCheckout()"
                class="px-6 py-2 bg-blue-600 rounded hover:bg-blue-700 font-semibold">Checkout</a>
        </div>
    </ng-container>

    <!-- CHECKOUT DIALOG -->
    <p-dialog [(visible)]="Dialog().checkOut" [modal]="true" [style]="{ minWidth: '30rem' }" header="Make Request">
        <div class="min-w-80 flex flex-col p-5 gap-5">

            <!-- Start Date -->
            <p-ifta-label>
                <p-datepicker [(ngModel)]="datePickerValues().StartDate" class="w-full" [minDate]="minStartDate"
                    (onSelect)="onStartDateChange($event)" id="client_cart_request_dialog_startdate"></p-datepicker>
                <label for="client_cart_request_dialog_startdate">Start Date</label>
            </p-ifta-label>

            <!-- Return Date -->
            <p-ifta-label>
                <p-datepicker [(ngModel)]="datePickerValues().ExpectedReturnDate" class="w-full"
                    [minDate]="minReturnDate" (onSelect)="onReturnDateChange($event)"
                    id="client_cart_request_expectedreturndate"></p-datepicker>
                <label for="client_cart_request_expectedreturndate">Return Date</label>
            </p-ifta-label>

            <!-- Borrow Price -->
            <p class="mt-4">Hi {{User().name}}! Your calculated borrow price is:</p>
            <div class="inline-grid grid-cols-2 gap-x-5">
                <i>For Per Day</i>
                <span>{{ total | currency: "INR" }}</span>
                <i>For {{ duration }} Day{{ duration > 1 ? 's' : '' }}</i>
                <span class="text-blue-600">{{ duration * total | currency: "INR" }}</span>
            </div>

            <!-- Request Button -->
            <div class="flex justify-end mt-4">
                <button pButton type="button" severity="success" (click)="handleRequestBorrow()">Request</button>
            </div>
        </div>
    </p-dialog>
</div>