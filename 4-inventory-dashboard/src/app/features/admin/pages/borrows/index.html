<div class="text-white rounded shadow-lg flex flex-col gap-5">

    <!-- ðŸ”¹ HEADER -->
    <div class="flex justify-between items-center">
        <div class="flex items-center gap-2">
            <i class="pi pi-receipt text-2xl" style="font-size: 2rem"></i>
            <h2 class="text-2xl">Borrows</h2>
        </div>

        <div class="flex gap-5 items-center">

            <!-- Search -->
            <p-iftalabel class="w-full min-w-62.5">
                <input pInputText (input)="onSearch($event)" placeholder="Search borrow..." class="min-w-70" />
                <label>Search by user | equipment</label>
            </p-iftalabel>

            <!-- Add Equipment -->
            <div class="p-3 rounded-full border border-gray-300 hover:border-green-500 bg-white hover:bg-red-50 flex items-center justify-center cursor-pointer transition-all duration-200 shadow-sm hover:shadow-md group relative"
                (click)="openDialog('addBorrow')" pTooltip="Add Equipment" tooltipPosition="bottom"
                tooltipStyleClass="custom-tooltip">
                <i
                    class="pi pi-plus text-gray-600 group-hover:text-green-600 text-lg active:scale-90 transition-all duration-200">
                </i>
            </div>
        </div>
    </div>

    <!-- Tabs -->
    <p-tabs value="0">
        <p-tablist>
            <p-tab value="0" (click)="onStatusTab(0)">
                <span class="flex items-center gap-2 text-lg font-medium">
                    All
                    <p-chip class="px-3 py-1 rounded-full text-sm font-semibold" [style]="getChipColor('secondary')">
                        {{ paginatorState().TotalCount || 0 }}
                    </p-chip>
                </span>
            </p-tab>
            <p-tab value="1" (click)="onStatusTab(1)">
                <span class="flex items-center gap-2 text-lg font-medium">
                    Requested
                    <p-chip class="px-3 py-1 rounded-full text-sm font-semibold" [style]="getChipColor('info')">
                        {{ Counts().Requested || 0 }}
                    </p-chip>
                </span>
            </p-tab>
            <p-tab value="2" (click)="onStatusTab(2)">
                <span class="flex items-center gap-2 text-lg font-medium">
                    Accepted
                    <p-chip class="px-3 py-1 rounded-full text-sm font-semibold" [style]="getChipColor('primary')">
                        {{ Counts().Accepted || 0 }}
                    </p-chip>
                </span>
            </p-tab>
            <p-tab value="3" (click)="onStatusTab(3)">
                <span class="flex items-center gap-2 text-lg font-medium">
                    Assigned
                    <p-chip class="px-3 py-1 rounded-full text-sm font-semibold" [style]="getChipColor('sky')">
                        {{ Counts().Assigned || 0 }}
                    </p-chip>
                </span>
            </p-tab>
            <p-tab value="4" (click)="onStatusTab(4)">
                <span class="flex items-center gap-2 text-lg font-medium">
                    Pending
                    <p-chip class="px-3 py-1 rounded-full text-sm font-semibold" [style]="getChipColor('warning')">
                        {{ Counts().Pending || 0}}
                    </p-chip>
                </span>
            </p-tab>
            <p-tab value="5" (click)="onStatusTab(5)">
                <span class="flex items-center gap-2 text-lg font-medium">
                    Paid
                    <p-chip class="px-3 py-1 rounded-full text-sm font-semibold" [style]="getChipColor('success')">
                        {{ Counts().Paid || 0 }}
                    </p-chip>
                </span>
            </p-tab>
            <p-tab value="6" (click)="onStatusTab(6)">
                <span class="flex items-center gap-2 text-lg font-medium">
                    Approved
                    <p-chip class="px-3 py-1 rounded-full text-sm font-semibold" [style]="getChipColor('green')">
                        {{ Counts().Approved || 0 }}
                    </p-chip>
                </span>
            </p-tab>
            <p-tab value="7" (click)="onStatusTab(7)">
                <span class="flex items-center gap-2 text-lg font-medium">
                    Waitlisted
                    <p-chip class="px-3 py-1 rounded-full text-sm font-semibold" [style]="getChipColor('orange')">
                        {{ Counts().Waitlisted || 0 }}
                    </p-chip>
                </span>
            </p-tab>
            <p-tab value="8" (click)="onStatusTab(8)">
                <span class="flex items-center gap-2 text-lg font-medium">
                    Ack
                    <p-chip class="px-3 py-1 rounded-full text-sm font-semibold" [style]="getChipColor('cyan')">
                        {{ Counts().Ack || 0 }}
                    </p-chip>
                </span>
            </p-tab>
            <p-tab value="9" (click)="onStatusTab(9)">
                <span class="flex items-center gap-2 text-lg font-medium">
                    Closed
                    <p-chip class="px-3 py-1 rounded-full text-sm font-semibold" [style]="getChipColor('neutral')">
                        {{ Counts().Closed || 0 }}
                    </p-chip>
                </span>
            </p-tab>
        </p-tablist>
    </p-tabs>

    <!-- Skeleton Table -->
    @if (isLoading() == true) {
    <p-table>
        <ng-template pTemplate="header">
            <tr>
                <th class="text-center">#</th>
                <th class="text-left">ID</th>
                <th class="text-left">User Name</th>
                <th class="text-center">Equipment Count</th>
                <th class="text-right">Total Price</th>
                <th class="text-center">Start Date</th>
                <th class="text-center">Expected Return</th>
                <th class="text-center">Actual Return</th>
                <th class="text-center">Duration</th>
                <th class="text-center">Actions</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body">
            <tr>
                <td><p-skeleton></p-skeleton></td>
                <td><p-skeleton></p-skeleton></td>
                <td><p-skeleton></p-skeleton></td>
                <td><p-skeleton></p-skeleton></td>
                <td><p-skeleton></p-skeleton></td>
                <td><p-skeleton></p-skeleton></td>
                <td><p-skeleton></p-skeleton></td>
                <td><p-skeleton></p-skeleton></td>
                <td><p-skeleton></p-skeleton></td>
                <td><p-skeleton></p-skeleton></td>
            </tr>
        </ng-template>
    </p-table>
    }

    <!-- Empty Table -->
    @else if (borrowList().length == 0) {
    <div>
        <p-table>
            <ng-template pTemplate="header">
                <tr>
                    <th class="text-center">#</th>
                    <th class="text-left">ID</th>
                    <th class="text-left">User Name</th>
                    <th class="text-center">Equipment Count</th>
                    <th class="text-right">Total Price</th>
                    <th class="text-center">Start Date</th>
                    <th class="text-center">Expected Return</th>
                    <th class="text-center">Actual Return</th>
                    <th class="text-center">Duration</th>
                    <th class="text-center">Actions</th>
                </tr>
            </ng-template>
        </p-table>
        <div class="flex justify-center items-center min-h-[30dvh] bg-charcoal">
            <span class="text-2xl">Oops! No Borrows found</span>
        </div>
    </div>
    }

    <!-- Data Table -->
    @else {
    <p-table [value]="borrowList()">
        <ng-template pTemplate="header">
            <tr>
                <th class="text-center">#</th>
                <th class="text-left">ID</th>
                <th class="text-left">User Name</th>
                <th class="text-center">Equipment Count</th>
                <th class="text-right">Total Price</th>
                <th class="text-center">Start Date</th>
                <th class="text-center">Expected Return</th>
                <th class="text-center">Actual Return</th>
                <th class="text-center">Duration</th>
                <th class="text-center">Actions</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-b let-i="rowIndex">
            <tr>
                <td class="text-center">{{ getIndex() + i + 1 }}</td>
                <td class="text-left">{{ b.id }}</td>
                <td class="text-left">{{ b.userName }}</td>
                <td class="text-center">{{ b.equipmentCounts }}</td>
                <td class="text-right">{{ b.totalPrice | currency: 'INR' }}</td>
                <td class="text-center whitespace-nowrap">{{ b.startDate | date:'MMM d, yyyy h:mm a' }}</td>
                <td class="text-center whitespace-nowrap">{{ b.expectedReturnDate | date:'MMM d, yyyy h:mm a' }}</td>
                <td class="text-center whitespace-nowrap">
                    @if(b.actualReturnDate){
                    <span>{{ b.actualReturnDate | date:'MMM d, yyyy h:mm a' }}</span>
                    } @else {
                    <span class="text-gray-600">null</span>
                    }
                </td>
                <td class="text-center">{{ b.expectedDuration }}</td>
                <td class="">
                    <div class="flex justify-start gap-2">
                        <!-- View -->
                        <span
                            class="w-8 h-8 rounded-full border border-gray-300 hover:border-blue-500 bg-white hover:bg-blue-50 flex items-center justify-center cursor-pointer transition-all duration-200 shadow-sm hover:shadow-md group"
                            pTooltip="View Borrow" tooltipPosition="bottom" tooltipStyleClass="custom-tooltip"
                            (click)="handleViewBorrow(b.id)">
                            <i class="pi pi-eye text-gray-600 group-hover:text-blue-600 transition-all duration-200"
                                style="font-size: 0.85rem;">
                            </i>
                        </span>

                        <!-- Accept -->
                        @if (b.status==1) {
                        <span
                            class="w-8 h-8 rounded-full border border-gray-300 hover:border-green-500 bg-white hover:bg-blue-50 flex items-center justify-center cursor-pointer transition-all duration-200 shadow-sm hover:shadow-md group"
                            pTooltip="Approve Borrow" tooltipPosition="bottom" tooltipStyleClass="custom-tooltip"
                            (click)="handleAcceptBorrow(b.id, b.userId)">
                            <i class="pi pi-check-square text-gray-600 group-hover:text-green-600 transition-all duration-200"
                                style="font-size: 0.85rem;">
                            </i>
                        </span>
                        }

                        <!-- Close -->
                        @if (b.status==1||b.status==5||b.status==7){
                        <span
                            class="w-8 h-8 rounded-full border border-gray-300 hover:border-red-500 bg-white hover:bg-blue-50 flex items-center justify-center cursor-pointer transition-all duration-200 shadow-sm hover:shadow-md group"
                            pTooltip="Close Borrow" tooltipPosition="bottom" tooltipStyleClass="custom-tooltip"
                            (click)="handleViewBorrow(b.id)">
                            <i class="pi pi-times-circle text-gray-600 group-hover:text-red-600 transition-all duration-200"
                                style="font-size: 0.85rem;">
                            </i>
                        </span>
                        }
                    </div>
                </td>
            </tr>
        </ng-template>
    </p-table>
    }
    <div class="flex justify-center items-center gap-5 mt-5">
        <div class=" flex justify-center items-center size-8 rounded-full cursor-pointer hover:border hover:border-zinc-400 active:scale-90 transition-all duration-200 ease-in-out"
            pTooltip="First Page" tooltipPosition="left" tooltipStyleClass="custom-tooltip" (click)="goToFirstPage()">
            <i class="pi pi-angle-double-left"></i>
        </div>
        <div class=" flex justify-center items-center size-8 rounded-full cursor-pointer hover:border hover:border-zinc-400 active:scale-90 transition-all duration-200 ease-in-out"
            (click)="goToPreviousPage()">
            <i class="pi pi-angle-left"></i>
        </div>
        <div class="px-5">
            {{paginatorState().PageNo}}
        </div>
        <div class=" flex justify-center items-center size-8 rounded-full cursor-pointer hover:border hover:border-zinc-400 active:scale-90 transition-all duration-200 ease-in-out"
            (click)="goToNextPage()">
            <i class="pi pi-angle-right"></i>
        </div>
        <div class=" flex justify-center items-center size-8 rounded-full cursor-pointer hover:border hover:border-zinc-400 active:scale-90 transition-all duration-200 ease-in-out"
            pTooltip="Last Page" tooltipPosition="right" tooltipStyleClass="custom-tooltip" (click)="goToLastPage()">
            <i class="pi pi-angle-double-right"></i>
        </div>
        <div class="flex gap-2 items-center">
            <p-select [options]="[5, 10, 25, 50]" [ngModel]="paginatorState().RowCount"
                (ngModelChange)="onRowChange($event)" class="w-full" /> Rows
        </div>
        <div>
            Showing :
            {{ (paginatorState().PageNo - 1) * paginatorState().RowCount + 1 }}
            -
            {{
            Math.min(
            paginatorState().PageNo * paginatorState().RowCount,
            paginatorState().TotalCount
            )
            }}
            of {{ paginatorState().TotalCount }}
        </div>
    </div>
</div>

<p-dialog [(visible)]="Dialog().accept" [modal]="true" [style]="{ width: 'fit' }" header="Approve Borrow">
    <div class="flex flex-col min-w-80 gap-5">
        <p-iftaLabel>
            <textarea pTextarea row="5" cols="50" id="admin_borrows_approve_premarks"
                [(ngModel)]="acceptPayload().PreRemarks" [autoResize]="true">
            </textarea>
            <label for="admin_borrows_approve_premarks">Pre Marks</label>
        </p-iftaLabel>
        <div class="flex justify-end">
            <p-button (click)="acceptBorrowService()" severity="success">Accept</p-button>
        </div>
    </div>
</p-dialog>